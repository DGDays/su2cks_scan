<!DOCTYPE html>
<html>
<head>
    <title>–û—Ç—á–µ—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è - {{ scan.target }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; }
        pre { background: #f5f5f5; padding: 15px; overflow: auto; }
        .port { margin: 10px 0; padding: 10px; background: #f9f9f9; }
    </style>
</head>
<body>
    <div class="container">
        <h1>–û—Ç—á–µ—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: {{ scan.target }}</h1>
        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> {{ scan.status }}</p>
        <p><strong>–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞:</strong> {{ scan.start_time }}</p>
        {% if scan.end_time %}
        <p><strong>–í—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:</strong> {{ scan.end_time }}</p>
        {% endif %}
        
        {% if scan.results.nmap %}
        <div class="section">
            <h2>Nmap –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
            <h3>–û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã:</h3>
            {% for port in scan.results.nmap.parsed_ports %}
            <div class="port">
                <strong>–ü–æ—Ä—Ç {{ port.port }} ({{ port.service }})</strong> - {{ port.state }}<br>
                –í–µ—Ä—Å–∏—è: {{ port.version }}
            </div>
            {% endfor %}
            
            <h3>–ü–æ–ª–Ω—ã–π –≤—ã–≤–æ–¥ Nmap:</h3>
            <pre>{{ scan.results.nmap.raw_output }}</pre>
        </div>
        {% endif %}
        
        {% if scan.results.nikto %}
        <div class="section">
            <h2>Nikto –†–µ–∑—É–ª—å—Ç–∞—Ç—ã (–ø–æ—Ä—Ç {{ scan.results.nikto.port }})</h2>
            <pre>{{ scan.results.nikto.output }}</pre>
        </div>
        {% endif %}
        
        {% if scan.results.gobuster %}
        <div class="section">
            <h2>Gobuster Dirs –†–µ–∑—É–ª—å—Ç–∞—Ç—ã (–ø–æ—Ä—Ç {{ scan.results.gobuster.port }})</h2>
            <pre>{{ scan.results.gobuster.output }}</pre>
        </div>
        {% endif %}

        {% if scan.results.gobuster_vhost %}
        <div class="section">
            <h2>Gobuster Domains –†–µ–∑—É–ª—å—Ç–∞—Ç—ã (–ø–æ—Ä—Ç {{ scan.results.gobuster_vhost.port }})</h2>
            <pre>{{ scan.results.gobuster_vhost.output }}</pre>
        </div>
        {% endif %}

        <!-- –°–µ–∫—Ü–∏—è –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π -->
        {% if scan.results.custom_scans %}
        <div class="section">
            <h2>üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
            {% for key, custom_scan in scan.results.custom_scans.items() %}
            <div style="margin: 15px 0; padding: 15px; border: 2px solid #28a745; border-radius: 5px; background: #f8fff9;">
                <h4>üéØ 
                    {% if custom_scan.scan_type == 'dir' %}–ü–æ–∏—Å–∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
                    {% else %}–ü–æ–∏—Å–∫ vhost{% endif %}
                    ({{ custom_scan.timestamp[:19] }})
                </h4>
                <p><strong>–°–ª–æ–≤–∞—Ä—å:</strong> {{ custom_scan.wordlist_used }}</p>
                <p><strong>–ü–æ—Ä—Ç:</strong> {{ custom_scan.port }}</p>
                <div style="margin-top: 10px;">
                    <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</strong>
                    <pre style="background: #f5f5f5; padding: 10px; border-radius: 3px; max-height: 300px; overflow-y: auto;">{{ custom_scan.output or '–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤' }}</pre>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
<div id="customScanModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 10px; min-width: 400px;">
        <h3>üöÄ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
        
        <div style="margin: 15px 0;">
            <label>–¢–∏–ø —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:</label>
            <select id="scanType" style="width: 100%; padding: 8px; margin: 5px 0;">
                <option value="dir">Gobuster Dir (–ø–æ–∏—Å–∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π)</option>
                <option value="vhost">Gobuster Vhost (–ø–æ–∏—Å–∫ –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤)</option>
            </select>
        </div>
        
        <div style="margin: 15px 0;">
            <label>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–∞—Ä—å:</label>
            <input type="file" id="customWordlistFile" 
                accept=".txt,.lst"
                style="width: 100%; padding: 8px; margin: 5px 0;">
            <small>–í—ã–±–µ—Ä–∏—Ç–µ .txt —Ñ–∞–π–ª —Å–æ —Å–ª–æ–≤–∞—Ä–µ–º</small>
            
            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—É—Ç–∏ -->
            <input type="hidden" id="selectedWordlistPath" value="/usr/share/wordlists/dirb/common.txt">
            
            <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ -->
            <div id="selectedFileInfo" style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px; display: none;">
                <strong>–í—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª:</strong> <span id="fileName"></span>
            </div>
        </div>
        
        <div style="margin: 15px 0;">
            <label>–ü–æ—Ä—Ç:</label>
            <input type="number" id="customPort" value="80" style="width: 100%; padding: 8px; margin: 5px 0;">
        </div>
        
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button onclick="startCustomScan()" style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
                üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å
            </button>
            <button onclick="closeCustomScanModal()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">
                ‚ùå –û—Ç–º–µ–Ω–∞
            </button>
        </div>
        
        <div id="customScanStatus" style="margin-top: 15px; display: none;"></div>
        
        <div style="margin-top: 15px; font-size: 12px; color: #666;">
            <strong>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ–≤–∞—Ä–∏:</strong><br>
            ‚Ä¢ /usr/share/wordlists/dirb/common.txt<br>
            ‚Ä¢ /usr/share/wordlists/dirb/big.txt<br>
        </div>
    </div>
</div>

<!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ -->
<div style="margin: 20px 0;">
    <button onclick="openCustomScanModal()" style="padding: 12px 25px; background: #ffc107; color: black; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
        üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    </button>
</div>

<script>
let currentTarget = "{{ scan.target }}";
let mainScanId = "{{ scan.id }}";
let selectedFilePath = '/usr/share/wordlists/dirb/common.txt';

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
document.getElementById('customWordlistFile').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const statusDiv = document.getElementById('customScanStatus');
        statusDiv.style.display = 'block';
        statusDiv.innerHTML = '<div style="color: #007bff;">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä...</div>';
        
        // –°–æ–∑–¥–∞–µ–º FormData –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
        const formData = new FormData();
        formData.append('file', file);
        
        fetch('/api/upload_wordlist', {
            method: 'POST',
            body: formData
        })
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                selectedFilePath = data.filepath;
                
                // –ë–µ–∑–æ–ø–∞—Å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                const fileNameDisplay = document.getElementById('fileNameDisplay');
                if (fileNameDisplay) {
                    fileNameDisplay.textContent = data.filename;
                }
                
                const selectedFileInfo = document.getElementById('selectedFileInfo');
                if (selectedFileInfo) {
                    selectedFileInfo.style.display = 'block';
                }
                
                statusDiv.innerHTML = `<div style="color: #28a745;">‚úÖ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω: ${data.filename}</div>`;
                setTimeout(() => statusDiv.style.display = 'none', 3000);
            } else {
                statusDiv.innerHTML = `<div style="color: #dc3545;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${data.error}</div>`;
            }
        })
        .catch(error => {
            statusDiv.innerHTML = `<div style="color: #dc3545;">‚ùå –û—à–∏–±–∫–∞: ${error}</div>`;
        });
    }
});

function openCustomScanModal() {
    document.getElementById('customScanModal').style.display = 'block';
}

function closeCustomScanModal() {
    document.getElementById('customScanModal').style.display = 'none';
    document.getElementById('customScanStatus').style.display = 'none';
    document.getElementById('customWordlistFile').value = '';
    
    const selectedFileInfo = document.getElementById('selectedFileInfo');
    if (selectedFileInfo) {
        selectedFileInfo.style.display = 'none';
    }
}

function startCustomScan() {
    const scanType = document.getElementById('scanType').value;
    const port = document.getElementById('customPort').value;
    const statusDiv = document.getElementById('customScanStatus');
    
    if (!statusDiv) {
        console.error('Element customScanStatus not found');
        return;
    }
    
    statusDiv.style.display = 'block';
    statusDiv.innerHTML = '<div style="color: #007bff;">‚è≥ –ó–∞–ø—É—Å–∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è...</div>';
    
    fetch('/api/custom_scan', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            target: currentTarget,
            scan_type: scanType,
            wordlist: selectedFilePath,
            port: parseInt(port),
            main_scan_id: mainScanId
        })
    })
    .then(r => r.json())
    .then(data => {
        if (data.status === 'started') {
            statusDiv.innerHTML = '<div style="color: #28a745;">‚úÖ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ! –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã...</div>';
            setTimeout(() => {
                location.reload();
            }, 3000);
        } else {
            statusDiv.innerHTML = '<div style="color: #dc3545;">‚ùå –û—à–∏–±–∫–∞: ' + (data.error || 'Unknown error') + '</div>';
        }
    })
    .catch(error => {
        statusDiv.innerHTML = '<div style="color: #dc3545;">‚ùå –û—à–∏–±–∫–∞: ' + error + '</div>';
    });
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ
const customScanModal = document.getElementById('customScanModal');
if (customScanModal) {
    customScanModal.addEventListener('click', function(e) {
        if (e.target.id === 'customScanModal') {
            closeCustomScanModal();
        }
    });
}
</script>
        
        <a href="/">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–∫–∞–Ω–µ—Ä—É</a>
                    <div style="margin: 20px 0;">
    <button onclick="saveAsPdf()" style="padding: 10px 15px; background: #dc3545; color: white; border: none; cursor: pointer;">
        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ PDF
    </button>
</div>

<script>
function saveAsPdf() {
    // –ü–æ–ª—É—á–∞–µ–º scan_id –∏–∑ URL
    const path = window.location.pathname;
    const scanId = path.split('/').pop();
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –æ—Ç—á–µ—Ç–∞
    const isArpReport = path.includes('arp_report');
    const endpoint = isArpReport ? `/save_as_pdf/${scanId}` : `/save_as_pdf/${scanId}`;
    
    window.open(endpoint, '_blank');
}
</script>
    </div>

</body>
</html>