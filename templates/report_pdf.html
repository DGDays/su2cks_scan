<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 10px; }
            .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; page-break-inside: avoid; }
            .port { margin: 8px 0; padding: 8px; background: #f9f9f9; }
            pre { 
                background: #f5f5f5; 
                padding: 10px; 
                font-size: 10px; 
                white-space: pre-wrap; /* –ü–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫ */
                word-wrap: break-word; /* –ü–µ—Ä–µ–Ω–æ—Å –¥–ª–∏–Ω–Ω—ã—Ö —Å–ª–æ–≤ */
                overflow: visible; /* –£–±–∏—Ä–∞–µ–º —Å–∫—Ä–æ–ª–ª */
                max-height: none !important; /* –£–±–∏—Ä–∞–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã */
            .timestamp { color: #666; font-size: 12px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Pentest Report: {{ scan.target }}</h1>
        <p class="timestamp">Generated: {{ scan.end_time or scan.start_time }}</p>
    </div>
    
    <div class="section">
        <h2>Scan Information</h2>
        <p><strong>Target:</strong> {{ scan.target }}</p>
        <p><strong>Status:</strong> {{ scan.status }}</p>
        <p><strong>Start Time:</strong> {{ scan.start_time }}</p>
        {% if scan.end_time %}
        <p><strong>End Time:</strong> {{ scan.end_time }}</p>
        {% endif %}
    </div>
    
    {% if scan.results.nmap %}
    <div class="section">
        <h2>Nmap Results</h2>
        {% for port in scan.results.nmap.parsed_ports %}
        <div class="port">
            <strong>Port {{ port.port }}</strong> ({{ port.service }}) - {{ port.state }}<br>
            Version: {{ port.version }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- NVD CVE Vulnerabilities -->
    {% if scan.results.vulnerability_analysis and scan.results.vulnerability_analysis.nvd_vulnerabilities %}
    <div class="section">
        <h2>üîç CVE Vulnerabilities (NVD)</h2>
        <p><strong>Total Found:</strong> {{ scan.results.vulnerability_analysis.nvd_total }}</p>
        
        {% for vuln in scan.results.vulnerability_analysis.nvd_vulnerabilities %}
        <div style="margin: 15px 0; padding: 15px; border: 2px solid 
            {% if vuln.severity == 'CRITICAL' %}#dc3545
            {% elif vuln.severity == 'HIGH' %}#fd7e14
            {% elif vuln.severity == 'MEDIUM' %}#ffc107
            {% else %}#28a745{% endif %}; 
            border-radius: 5px; background: #f8f9fa;">
            <h4 style="margin: 0 0 10px 0;">
                {{ vuln.cve_id }} 
                <span style="color: 
                    {% if vuln.severity == 'CRITICAL' %}#dc3545
                    {% elif vuln.severity == 'HIGH' %}#fd7e14
                    {% elif vuln.severity == 'MEDIUM' %}#ffc107
                    {% else %}#28a745{% endif %}; 
                    font-weight: bold;">
                    [{{ vuln.severity }}]
                </span>
                {% if vuln.cvss_score != 'N/A' %}
                <span style="color: #6c757d; font-size: 14px;">
                    (CVSS: {{ vuln.cvss_score }})
                </span>
                {% endif %}
            </h4>
            <p style="margin: 5px 0;"><strong>Service:</strong> {{ vuln.service }} {{ vuln.version }} (port {{ vuln.port }})</p>
            <p style="margin: 5px 0;"><strong>Description:</strong> {{ vuln.description }}</p>
            <p style="margin: 10px 0 0 0;">
                <a href="https://nvd.nist.gov/vuln/detail/{{ vuln.cve_id }}" target="_blank" 
                style="color: #007bff; text-decoration: none;">
                    üîó View details on NVD
                </a>
            </p>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- FSTEC Vulnerabilities -->
    {% if scan.results.vulnerability_analysis and scan.results.vulnerability_analysis.fstec_vulnerabilities %}
    <div class="section">
        <h2>üá∑üá∫ FSTEC Vulnerabilities</h2>
        <p><strong>Total Found:</strong> {{ scan.results.vulnerability_analysis.fstec_total }}</p>
        
        {% for vuln in scan.results.vulnerability_analysis.fstec_vulnerabilities %}
        <div style="margin: 15px 0; padding: 15px; border: 2px solid #dc3545; border-radius: 5px; background: #fff5f5;">
            <h4 style="margin: 0 0 10px 0; color: #dc3545;">
                {{ vuln.vuln_id }} 
                <span style="color: #dc3545; font-weight: bold;">
                    [{{ vuln.severity }}]
                </span>
            </h4>
            <p style="margin: 5px 0;"><strong>Service:</strong> {{ vuln.service }} {{ vuln.version }} (port {{ vuln.port }})</p>
            <p style="margin: 5px 0;"><strong>Name:</strong> {{ vuln.name }}</p>
            <p style="margin: 5px 0;"><strong>Description:</strong> {{ vuln.description[:200] }}{% if vuln.description|length > 200 %}...{% endif %}</p>
            <p style="margin: 5px 0;"><strong>Publication Date:</strong> {{ vuln.publication_date }}</p>
            {% if vuln.solution and vuln.solution != 'N/A' %}
            <p style="margin: 5px 0;"><strong>Solution:</strong> {{ vuln.solution[:200] }}{% if vuln.solution|length > 200 %}...{% endif %}</p>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Searchsploit Exploits Section -->
    {% if scan.results.exploits %}
    <div class="section">
        <h2>üí• Searchsploit Results</h2>
        <p><strong>Command:</strong> <code>{{ scan.results.exploits.command }}</code></p>
        <p><strong>Time:</strong> {{ scan.results.exploits.timestamp[:19] }}</p>
        
        <div style="margin-top: 15px;">
            <strong>Found Exploits:</strong>
            <pre style="background: #fff5f5; padding: 15px; border-radius: 5px; max-height: 400px; overflow-y: auto;">{{ scan.results.exploits.searchsploit_output }}</pre>
        </div>
    </div>
    {% endif %}
    
    {% if scan.results.nikto %}
    <div class="section">
        <h2>Nikto Results</h2>
        <pre>{{ scan.results.nikto.output }}</pre>
    </div>
    {% endif %}
    
    {% if scan.results.gobuster %}
    <div class="section">
        <h2>Gobuster Dirs Results</h2>
        <pre>{{ scan.results.gobuster.output }}</pre>
    </div>
    {% endif %}

    {% if scan.results.gobuster_vhost %}
    <div class="section">
        <h2>Gobuster Domains Results</h2>
        <pre>{{ scan.results.gobuster_vhost.output }}</pre>
    </div>
    {% endif %}
    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
    {% if scan.results.custom_scans %}
    <div class="section">
        <h2>Additional Scans</h2>
        {% for key, custom_scan in scan.results.custom_scans.items() %}
        <div class="custom-scan">
            <h4>
                {% if custom_scan.scan_type == 'dir' %}Directory Search
                {% elif custom_scan.scan_type == 'vhost' %}Vhost Search
                {% elif custom_scan.scan_type == 'sqlmap' %}SQL Injection Test
                {% else %}{{ custom_scan.scan_type }}{% endif %}
                ({{ custom_scan.timestamp[:19] }})
            </h4>
            
            {% if custom_scan.scan_type == 'dir' or custom_scan.scan_type == 'vhost' %}
            <p><strong>Wordlist:</strong> {{ custom_scan.wordlist_used }}</p>
            <p><strong>Port:</strong> {{ custom_scan.port }}</p>
            {% elif custom_scan.scan_type == 'sqlmap' %}
            <p><strong>Commands:</strong> <code>sqlmap {{ custom_scan.commands }}</code></p>
            <p><strong>Status:</strong> {% if custom_scan.success %}‚úÖ Success{% else %}‚ùå Failed{% endif %}</p>
            {% endif %}
            
            <div style="margin-top: 10px;">
                <strong>Results:</strong>
                <pre style="background: #f5f5f5; padding: 10px; border-radius: 3px; max-height: 300px; overflow-y: auto;">{{ custom_scan.output or 'No results' }}</pre>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- –°—Ç–∞—Ä—ã–µ SQLMap —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏) -->
    {% if scan.results.sqlmap %}
    <div class="section">
        <h2>SQLMap Results</h2>
        <p><strong>Command:</strong> <code>sqlmap {{ scan.results.sqlmap.commands }}</code></p>
        <p><strong>Status:</strong> {% if scan.results.sqlmap.success %}‚úÖ Success{% else %}‚ùå Failed{% endif %}</p>
        <p><strong>Return Code:</strong> {{ scan.results.sqlmap.returncode }}</p>
        
        {% if scan.results.sqlmap.output %}
        <h4>SQLMap Output:</h4>
        <pre style="background: #f5f5f5; padding: 10px; border-radius: 3px; max-height: 400px;">{{ scan.results.sqlmap.output }}</pre>
        {% endif %}
        
        {% if scan.results.sqlmap.error %}
        <h4>Errors:</h4>
        <pre style="background: #fff5f5; padding: 10px; border-radius: 3px; max-height: 200px;">{{ scan.results.sqlmap.error }}</pre>
        {% endif %}
    </div>
    {% endif %}
</body>
</html>