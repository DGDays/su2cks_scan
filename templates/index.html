<!DOCTYPE html>
<html>
<head>
    <title>(SU)¬≤CKS Scanner</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 800px; margin: 0 auto; }
        .form-group { margin: 20px 0; }
        input[type="text"] { padding: 10px; width: 300px; }
        button { padding: 10px 20px; background: #007cba; color: white; border: none; cursor: pointer; }
        button:hover { background: #005a87; }
        .results { margin-top: 20px; padding: 20px; border: 1px solid #ddd; }
        .status { padding: 10px; margin: 10px 0; }
        .running { background: #fff3cd; }
        .completed { background: #d1ecf1; }
        .error { background: #f8d7da; }
        .arp-results { background: #e8f5e8; border: 2px solid #28a745; }
        .host-list { margin: 15px 0; }
        .host-item { 
            padding: 8px; 
            margin: 5px 0; 
            background: white; 
            border: 1px solid #ddd;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .scan-host-btn { 
            padding: 5px 10px; 
            background: #28a745; 
            color: white; 
            border: none; 
            border-radius: 3px;
            cursor: pointer;
            margin-left: 10px;
        }
        .scan-host-btn:hover { background: #218838; }
        .save-arp-btn { 
            padding: 8px 15px; 
            background: #6c757d; 
            color: white; 
            border: none; 
            border-radius: 3px;
            cursor: pointer;
            margin: 10px 0;
        }
        .save-arp-btn:hover { background: #545b62; }
        .arp-permanent { 
            background: #d4edda; 
            border-left: 4px solid #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Pentest Scanner</h1>
        
        <div class="form-group">
            <input type="text" id="target" placeholder="–í–≤–µ–¥–∏—Ç–µ IP, –¥–æ–º–µ–Ω –∏–ª–∏ —Å–µ—Ç—å (192.168.1.0/24)" />
            <button onclick="startScan()">–ù–∞—á–∞—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
        </div>
        
        <p><small>–ü—Ä–∏–º–µ—Ä—ã: example.com, 192.168.1.1, 192.168.1.0/24</small></p>
        
        <div id="results"></div>
        
        <h2>–ò—Å—Ç–æ—Ä–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h2>
        <div id="scanList"></div>
        
        <!-- –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –±–ª–æ–∫ –¥–ª—è ARP —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
        <div id="arpHistory" style="margin-top: 30px;"></div>
                    <button onclick="saveDashboardPdf()" style="padding: 10px 15px; background: #28a745; color: white; border: none; cursor: pointer; margin: 10px 0;">
    üìä –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞—à–±–æ—Ä–¥ –≤ PDF
</button>

<script>
function saveDashboardPdf() {
    // –ü–µ—Ä–µ–¥–∞–µ–º ARP –∏—Å—Ç–æ—Ä–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    fetch('/save_dashboard_with_arp', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ arp_history: arpScans })
    })
    .then(response => response.blob())
    .then(blob => {
        // –°–∫–∞—á–∏–≤–∞–µ–º PDF
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'pentest_dashboard.pdf';
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
    })
    .catch(error => {
        console.error('Error saving dashboard:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ PDF');
    });
}
</script>
    </div>
            

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è ARP —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        let arpScans = [];
        
        function startScan() {
            const target = document.getElementById('target').value;
            if (!target) return alert('–í–≤–µ–¥–∏—Ç–µ target');
            
            fetch('/api/scan', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ target: target })
            })
            .then(r => r.json())
            .then(data => {
                if (data.status === 'arp_completed') {
                    showArpResults(data);
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é ARP —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
                    saveArpToHistory(data);
                } else if (data.scan_id) {
                    checkStatus(data.scan_id);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('results').innerHTML = 
                    '<div class="status error">–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</div>';
            });
        }
        
        function showArpResults(data) {
            const resultsDiv = document.getElementById('results');
            let html = `<div class="status arp-results">
                <h3>üîç ARP –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: ${data.network}</h3>
                <p>${data.message}</p>
                <button class="save-arp-btn" onclick="saveArpToHistory(${JSON.stringify(data).replace(/"/g, '&quot;')})">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç—Ç–æ ARP —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                </button>`;
            
            if (data.hosts && data.hosts.length > 0) {
                html += `<div class="host-list">
                    <h4>–ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ö–æ—Å—Ç—ã:</h4>`;
                
                data.hosts.forEach(ip => {
                    html += `<div class="host-item">
                        <span>üì° ${ip}</span>
                        <div>
                            <button class="scan-host-btn" onclick="scanSingleHost('${ip}')">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                        </div>
                    </div>`;
                });
                
                html += `</div>`;
            } else {
                html += `<p>–•–æ—Å—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>`;
            }
            
            html += `</div>`;
            resultsDiv.innerHTML = html;
        }
        
        function saveArpToHistory(arpData) {
            // –î–æ–±–∞–≤–ª—è–µ–º timestamp –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
            arpData.timestamp = new Date().toISOString();
            arpData.saved = true;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤ ARP —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
            arpScans.unshift(arpData);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            localStorage.setItem('arpScansHistory', JSON.stringify(arpScans));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ ARP
            renderArpHistory();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            showNotification('ARP —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –∏—Å—Ç–æ—Ä–∏–∏!');
        }
        
        function renderArpHistory() {
            const arpHistoryDiv = document.getElementById('arpHistory');
            
            if (arpScans.length === 0) {
                arpHistoryDiv.innerHTML = '';
                return;
            }
            
            let html = `<h2>üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ ARP —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>`;
            
            arpScans.forEach((scan, index) => {
                html += `<div class="status arp-permanent">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h4>üîç ${scan.network} (${scan.hosts_found} —Ö–æ—Å—Ç–æ–≤)</h4>
                        <div>
                            <button class="scan-host-btn" onclick="loadArpScan(${index})">–ü–æ–∫–∞–∑–∞—Ç—å</button>
                            <button class="scan-host-btn" style="background: #dc3545;" onclick="removeArpScan(${index})">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                    <p>–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: ${new Date(scan.timestamp).toLocaleString()}</p>
                </div>`;
            });
            
            arpHistoryDiv.innerHTML = html;
        }
        
        function loadArpScan(index) {
            const scan = arpScans[index];
            const resultsDiv = document.getElementById('results');
            
            let html = `<div class="status arp-results">
                <h3>üîç –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ ARP —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: ${scan.network}</h3>
                <p>${scan.message} (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: ${new Date(scan.timestamp).toLocaleString()})</p>
                <p><a href="/arp_report/${scan.scan_id}" target="_blank">üìÑ –û—Ç–∫—Ä—ã—Ç—å –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç</a></p>`;
            
            if (scan.hosts && scan.hosts.length > 0) {
                html += `<div class="host-list">
                    <h4>–ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ö–æ—Å—Ç—ã:</h4>`;
                
                scan.hosts.forEach(ip => {
                    html += `<div class="host-item">
                        <span>üì° ${ip}</span>
                        <button class="scan-host-btn" onclick="scanSingleHost('${ip}')">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>`;
                });
                
                html += `</div>`;
            }
            
            html += `</div>`;
            resultsDiv.innerHTML = html;
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }
        
        function removeArpScan(index) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ ARP —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏?')) {
                arpScans.splice(index, 1);
                localStorage.setItem('arpScansHistory', JSON.stringify(arpScans));
                renderArpHistory();
                showNotification('ARP —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏');
            }
        }
        
        function scanSingleHost(ip) {
            document.getElementById('target').value = ip;
            startScan();
        }
        
        function showNotification(message) {
            // –ü—Ä–æ—Å—Ç–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            alert(message);
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é ARP –∏–∑ localStorage –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function loadArpHistoryFromStorage() {
            const saved = localStorage.getItem('arpScansHistory');
            if (saved) {
                arpScans = JSON.parse(saved);
                renderArpHistory();
            }
        }
        
        function checkStatus(scanId) {
            const resultsDiv = document.getElementById('results');
            
            function poll() {
                fetch('/api/scan/' + scanId)
                    .then(r => r.json())
                    .then(scan => {
                        let html = `<div class="status ${scan.status}">
                            <h3>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: ${scan.target}</h3>
                            <p>–°—Ç–∞—Ç—É—Å: ${scan.status}</p>
                            <p>–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞: ${scan.start_time}</p>`;
                        
                        if (scan.status === 'completed') {
                            html += `<p>–í—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: ${scan.end_time}</p>`;
                            html += `<p><a href="/report/${scanId}" target="_blank">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç</a></p>`;
                            
                            if (scan.results.nmap) {
                                html += `<h4>Nmap —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h4>`;
                                html += `<pre>${JSON.stringify(scan.results.nmap.parsed_ports, null, 2)}</pre>`;
                            }
                            if (scan.results.nikto) {
                                html += `<h4>Nikto —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h4>`;
                                html += `<pre>${scan.results.nikto.output.substring(0, 500)}...</pre>`;
                            }
                        } else if (scan.status === 'running') {
                            html += `<p>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è... (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã)</p>`;
                            setTimeout(poll, 3000);
                        }
                        
                        html += `</div>`;
                        resultsDiv.innerHTML = html;
                    });
            }
            
            poll();
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
        function loadScanHistory() {
            fetch('/api/scans')
                .then(r => r.json())
                .then(data => {
                    const listDiv = document.getElementById('scanList');
                    if (data.scans.length === 0) {
                        listDiv.innerHTML = '<p>–ù–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</p>';
                    } else {
                        let html = '<ul>';
                        data.scans.forEach(scan => {
                            const type = scan.type === 'arp_scan' ? 'üîç ARP' : 'üéØ Single';
                            html += `<li><a href="${scan.type === 'arp_scan' ? '/arp_report/' : '/report/'}${scan.id}">${type}: ${scan.target} - ${scan.status} (${scan.start_time})</a></li>`;
                        });
                        html += '</ul>';
                        listDiv.innerHTML = html;
                    }
                });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadScanHistory();
            loadArpHistoryFromStorage();
        });
    </script>
</body>
</html>